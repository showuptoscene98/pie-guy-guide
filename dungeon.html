<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Dungeon Overlay</title>
<style>
  html, body { height:100%; }
  body {
    margin:0;
    background:#111;
    color:#fff;
    font-family:Arial, sans-serif;
    overflow:hidden;
  }

  .titlebar {
    height: 64px;
    background: #000;
    display:flex;
    flex-direction:column;
    padding: 8px 10px;
    -webkit-app-region: drag;
    user-select:none;
  }

  .toprow{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }

  .buttons {
    display:flex;
    flex-wrap:wrap;
    gap:6px;
    margin-top:6px;
    -webkit-app-region: no-drag;
  }

  .btn {
    padding:4px 8px;
    font-size:11px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.2);
    background:#222;
    color:#fff;
    cursor:pointer;
  }
  .btn:hover { background:#333; }

  .stage {
    width:100vw;
    height:calc(100vh - 64px);
    overflow:hidden;
    position:relative;
    touch-action:none;
    background:
      radial-gradient(800px 500px at 20% 10%, rgba(255,204,77,0.08), transparent 55%),
      radial-gradient(800px 500px at 80% 20%, rgba(90,120,255,0.10), transparent 60%),
      #111;
  }

  .canvas {
    position:absolute;
    left:0;
    top:0;
    transform-origin:0 0;
    cursor:grab;
  }
  .canvas.dragging { cursor:grabbing; }

  img {
    display:block;
    max-width:none;
    user-select:none;
    -webkit-user-drag:none;
    pointer-events:none;
  }

  .hint{
    font-size:12px;
    color:rgba(255,255,255,0.70);
    margin-top:2px;
  }
</style>
</head>
<body tabindex="0">

<div class="titlebar">
  <div class="toprow">
    <div>
      <div style="font-weight:900;">Dungeons</div>
      <div class="hint">Drag to pan • Mouse wheel zooms at cursor • ESC closes</div>
    </div>
    <button class="btn" style="-webkit-app-region:no-drag;" onclick="window.api.closeOverlay()">Close</button>
  </div>
  <div class="buttons" id="dungeonButtons"></div>
</div>

<div class="stage" id="stage">
  <div class="canvas" id="canvas">
    <img id="dungeonImage" src="" draggable="false" alt="Dungeon" />
  </div>
</div>

<script>
  window.addEventListener("contextmenu", (e) => e.preventDefault());
  window.addEventListener("dragstart", (e) => e.preventDefault());

  function forceFocus(){
    document.body.focus();
    window.focus();
  }
  window.addEventListener("load", forceFocus);
  window.addEventListener("focus", forceFocus);
  document.addEventListener("mousedown", forceFocus);

  window.addEventListener("keydown", (e) => {
    if (e.key === "Escape") window.api.closeOverlay();
  });

 const dungeons = [
  "Goblin Dungeon Lower",
  "Goblin Dungeon Upper",
  "Kur Tower",
  "Rahu Sewer",
  "Serbule Crypt",
  "Wolf Cave",
  "Yeti Cave",
  "Myconian Cave"
];


  const dungeonButtons = document.getElementById("dungeonButtons");
  const dungeonImage = document.getElementById("dungeonImage");
  const stage = document.getElementById("stage");
  const canvas = document.getElementById("canvas");

  let scale = 0.8;
  let x = 40;
  let y = 40;

  function applyTransform(){
    canvas.style.transform = `translate(${x}px, ${y}px) scale(${scale})`;
  }

  function loadDungeon(name){
    dungeonImage.src = `dungeons/${name}.jpg`;
    scale = 0.8; x = 40; y = 40;
    applyTransform();
  }

  dungeons.forEach((name) => {
    const btn = document.createElement("button");
    btn.className = "btn";
    btn.textContent = name;
    btn.addEventListener("click", () => loadDungeon(name));
    dungeonButtons.appendChild(btn);
  });

  loadDungeon(dungeons[0]);

  // Pan
  let dragging = false;
  let start = { px:0, py:0, x:0, y:0 };

  stage.addEventListener("pointerdown", (e) => {
    dragging = true;
    stage.setPointerCapture(e.pointerId);
    start = { px: e.clientX, py: e.clientY, x, y };
    canvas.classList.add("dragging");
  });

  stage.addEventListener("pointermove", (e) => {
    if (!dragging) return;
    x = start.x + (e.clientX - start.px);
    y = start.y + (e.clientY - start.py);
    applyTransform();
  });

  stage.addEventListener("pointerup", () => {
    dragging = false;
    canvas.classList.remove("dragging");
  });
  stage.addEventListener("pointercancel", () => {
    dragging = false;
    canvas.classList.remove("dragging");
  });

  // Zoom at cursor
  stage.addEventListener("wheel", (e) => {
    e.preventDefault();

    const rect = stage.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;

    const wx = (mx - x) / scale;
    const wy = (my - y) / scale;

    const zoomIntensity = 0.0015;
    const next = clamp(scale * (1 + (-e.deltaY * zoomIntensity)), 0.2, 3.5);

    x = mx - wx * next;
    y = my - wy * next;
    scale = next;

    applyTransform();
  }, { passive:false });

  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
</script>

</body>
</html>
